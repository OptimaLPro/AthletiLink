<!-- FILEPATH: /c:/Users/Omer/Documents/GitHub/AthletiLink/create_post.html -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Post</title>
    <link rel="icon" type="image/x-icon" href="/assets/images/Favicon/Regular/favicon-32x32.png" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" />
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <link rel="stylesheet" href="assets/css/styles.css" />
    <script
        src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="assets/js/image_upload.js"></script>
    <style>
        /* CSS styles */
    </style>
</head>

<body>
    <div class="container mt-6 effect-fadeIn">
        <form action="http://localhost:5500/create_post" method="post">
            <h2 class="text-center mb-4">Create Post</h2>

            <!-- Group selection -->
            <div class="form-group">
                <label for="group">Group</label>
                <select id="group" name="group" class="form-control" required>
                </select>
            </div>

            <!-- Title input -->
            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" id="title" name="title" class="form-control" maxlength="50" required value="test" />
            </div>

            <!-- Duration selection -->
            <div class="form-group">
                <label for="duration">Duration</label>
                <select id="duration" name="duration" class="form-control duration-dropdown" required>
                    <option value="15">15 minutes</option>
                    <option value="30">30 minutes</option>
                    <option value="45" selected="true">45 minutes</option>
                    <option value="60">1 hour</option>
                    <option value="75">1 hour 15 minutes</option>
                    <option value="90">1 hour 30 minutes</option>
                    <option value="105">1 hour 45 minutes</option>
                    <option value="120">2 hours</option>
                </select>
            </div>

            <!-- Time selection -->
            <div class="form-group">
                <label for="time">Time</label>
                <select id="time" name="time" class="form-control" required>
                </select>
            </div>

            <!-- Date input -->
            <div class="form-group">
                <label for="Date">Date</label>
                <div class="input-group date">
                    <input type="text" class="form-control" id="datepicker" name="date" required>
                    <div class="input-group-addon">
                        <span class="glyphicon glyphicon-th"></span>
                    </div>
                </div>
            </div>

            <!-- Location input -->
            <div class="form-group">
                <label for="location">Location</label>
                <input type="text" id="location" name="location" class="form-control" maxlength="100" required
                    placeholder="" value="Tel Aviv, Israel" />
            </div>

            <!-- Description textarea -->
            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" class="form-control" rows="4" required>test</textarea>
            </div>

            <!-- Profile picture upload -->
            <div class="form-group">
                <label for="profilePicture">Cover Picture</label>
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="profilePicture" name="profilePicture"
                        accept="image/*" onchange="fileChange()" required>
                    <label class="custom-file-label" id="profilePictureLabel" for="profilePicture">Choose file</label>
                </div>
            </div>

            <!-- Progress bar -->
            <div class="form-group">
                <div class="progress" style="margin-top: 10px; display: none;">
                    <div class="progress-bar" role="progressbar" id="uploadProgressBar" style="width: 0%;"
                        aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                </div>
            </div>

            <!-- Hidden fields -->
            <input type="hidden" id="profilePictureUrl" name="profilePictureUrl">
            <div class="form-group">
                <input type="hidden" id="like" name="like" value="0" />
                <input type="hidden" id="did" name="did" value="0" />
                <input type="hidden" id="comments" name="comments" value="0" />
            </div>

            <!-- Information message -->
            <div>
                <br>
                <p class="text-center">Heads up! It might take around 10 minutes for us to give your request the thumbs
                    up. ðŸ˜Š</p>
                <br>
            </div>

            <!-- Submit button -->
            <div class="form-group">
                <button type="submit" class="btn btn-dark btn-block">
                    Submit your request
                </button>
            </div>
        </form>
    </div>

    <!-- Close icon -->
    <div id="close-icon" class="position-fixed" style="top: 30px; right: 30px; font-size: 20px; cursor: pointer;">
        <a href="index.html" style="text-decoration: none;"><span class="fa-stack fa-lg" style="color:#343a40;">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-times fa-stack-1x fa-inverse"></i>
            </span></a>
    </div>

    <!-- Location alert -->
    <div class="alert alert-danger fade show" id="locationAlert" role="alert"
        style="display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999;">
        Invalid location. Please select a location from the suggestions.
    </div>

</body>

</html>

<script>
    // FILEPATH: /c:/Users/Omer/Documents/GitHub/AthletiLink/create_post.html

    // Initialize datepicker
    $(document).ready(function () {
        $('#datepicker').datepicker({
            format: 'dd/mm/yyyy',
            autoclose: true
        });
    });

    var input = document.getElementById('location');
    var autocomplete = new google.maps.places.Autocomplete(input);
    var locationAlert = $('#locationAlert');

    // Listen for place selection
    autocomplete.addListener('place_changed', function () {
        var place = autocomplete.getPlace();

        if (!place.geometry) {
            validLocationSelected = false;
            showAlert(locationAlert);
        } else {
            validLocationSelected = true;
            locationAlert.hide();
            input.value = place.formatted_address;
        }
    });

    $("form").submit(function (e) {
        e.preventDefault();
        if (validLocationSelected) {
            if (uploaded) {
                this.submit();
            }
        } else {
            showAlert(locationAlert);
        }
    });

    function showAlert(alertElement) {
        alertElement.show();
        setTimeout(function () {
            alertElement.fadeOut();
        }, 3000);
    }

    document.addEventListener('DOMContentLoaded', function () {
        // Fetch user groups
        fetch('http://localhost:5500/user_groups/')
            .then(response => response.json())
            .then(data => {
                const allGroups = data.user_groups_res;
                const groupDropdown = document.getElementById('group');
                allGroups.forEach(function (group) {
                    const option = document.createElement('option');
                    option.value = group.group;
                    option.text = group.group;
                    groupDropdown.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching groups:', error));

        var timeDropdown = document.getElementById('time');

        // Loop through all 24 hours and add options with 15-minute intervals
        for (var hour = 0; hour < 24; hour++) {
            for (var minute = 0; minute < 60; minute += 15) {
                // Format the hour and minute to HH:MM format
                var formattedHour = hour.toString().padStart(2, '0');
                var formattedMinute = minute.toString().padStart(2, '0');

                // Create an option element
                var option = document.createElement('option');
                option.value = formattedHour + ':' + formattedMinute;
                option.text = formattedHour + ':' + formattedMinute;

                // Append the option to the dropdown
                timeDropdown.appendChild(option);
            }
        }
        timeDropdown.value = "18:00";
    });
</script>